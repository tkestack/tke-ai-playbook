# vllm Benchmark Baseline

2 nodes, per node use 2 * 8 * H20 96GB

## Image

```Dockerfile
FROM vllm/vllm-openai:v0.9.0.1
RUN pip3 install pyarrow pandas
```

## Command
```bash
vllm serve /data/models/deepseek-ai/DeepSeek-R1 \
  --served-model-name deepseek-ai/DeepSeek-R1 \
  --block-size 128 \
  --max-model-len 4096 \
  --max-num-batched-tokens 4096 \
  --no-enable-prefix-caching \
  --enable-chunked-prefill \
  --compilation-config '{"cudagraph_capture_sizes": [1, 2, 4, 8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96, 104, 112, 120, 128, 136, 144, 152, 160, 168, 176, 184, 192, 200, 208, 216, 224, 232, 240, 248, 256]}' \
  -tp 16 \
  --disable-log-requests \
  --enable-reasoning \
  --reasoning-parser deepseek_r1
```

## Benchmark Result (ISL:OSL=3000:150)

| Concurrency | Reqeuest Throughput (req/s) | Output Token Throughput (tok/s) | Mean E2E Lantency (ms)  | P99 E2E Lantency (ms) | Mean TTFT (ms) | P99 TTFT (ms) | Mean TPOT (ms) | P99 TPOT (ms) |
|:-----------:|:--------------------------:|:-------------------------------:|:-----------------------:|:---------------------:|:--------------:|:-------------:|:-------------:|:------------:|
| 1 | 0.2 | 29.9 | 5016.14 | 5560.93 | 513.33 | 1068.2 | 30.22 | 30.51 |
| 2 | 0.36 | 54.51 | 5501.34 | 5971.67 | 439.24 | 812.74 | 33.97 | 37.73 |
| 4 | 0.68 | 101.67 | 5829.71 | 6642.35 | 367.32 | 841.17 | 36.66 | 42.41 |
| 8 | 1.13 | 169.02 | 6951.91 | 8278.04 | 496.53 | 1540.55 | 43.32 | 52.71 |
| 16 | 1.8 | 270.29 | 8626.39 | 10535.95 | 553.71 | 2492.27 | 54.18 | 68.05 |
| 32 | 2.71 | 406.14 | 11456.56 | 16417.23 | 696.91 | 4631.5 | 72.21 | 97.94 |
| 64 | 3.78 | 567.08 | 16542.7 | 24060.38 | 1084.23 | 8851.38 | 103.75 | 130.39 |
| 128 | 4.67 | 699.88 | 27047.74 | 51039.33 | 1783.79 | 17642.34 | 169.56 | 243.9 |

## Benchmark Result (ISL:OSL=1000:1000)

| Concurrency | Reqeuest Throughput (req/s) | Output Token Throughput (tok/s) | Mean E2E Lantency (ms)  | P99 E2E Lantency (ms) | Mean TTFT (ms) | P99 TTFT (ms) | Mean TPOT (ms) | P99 TPOT (ms) |
|:-----------:|:--------------------------:|:-------------------------------:|:-----------------------:|:---------------------:|:--------------:|:-------------:|:-------------:|:------------:|
| 1 | 0.03 | 33.51 | 29845.17 | 30279.6 | 162.07 | 169.03 | 29.71 | 30.14 |
| 2 | 0.06 | 63.17 | 31649.97 | 34376.97 | 180.32 | 290.04 | 31.5 | 34.22 |
| 4 | 0.11 | 113.28 | 34676.18 | 36253.59 | 199.21 | 386.32 | 34.51 | 36.11 |
| 8 | 0.21 | 213.54 | 37001.96 | 38532.8 | 229.99 | 709.03 | 36.81 | 38.36 |
| 16 | 0.38 | 378.03 | 41146.09 | 44803.75 | 259.07 | 934.82 | 40.93 | 44.62 |
| 32 | 0.66 | 656.18 | 47648.11 | 51948.52 | 338.13 | 1678.35 | 47.36 | 51.62 |
| 64 | 1.15 | 1151.16 | 54969.06 | 59232.29 | 456.76 | 3280.63 | 54.57 | 57.83 |
| 128 | 1.82 | 1822.81 | 69296.94 | 75515.71 | 707.81 | 6085.24 | 68.66 | 75.14 |

## Benchmark Result (ISL:OSL=500:1000)
| Concurrency | Reqeuest Throughput (req/s) | Output Token Throughput (tok/s) | Mean E2E Lantency (ms)  | P99 E2E Lantency (ms) | Mean TTFT (ms) | P99 TTFT (ms) | Mean TPOT (ms) | P99 TPOT (ms) |
|:-----------:|:--------------------------:|:-------------------------------:|:-----------------------:|:---------------------:|:--------------:|:-------------:|:-------------:|:------------:|
| 1 | 0.03 | 33.5 | 29852.45 | 30720.51 | 156.23 | 169.01 | 29.73 | 30.59 |
| 2 | 0.06 | 62.29 | 32066.73 | 34792.14 | 175.3 | 362.64 | 31.92 | 34.65 |
| 4 | 0.11 | 112.28 | 34869.94 | 38576.59 | 185.61 | 316.11 | 34.72 | 38.43 |
| 8 | 0.22 | 216.53 | 36667.98 | 38721.86 | 211.84 | 389.91 | 36.49 | 38.32 |
| 16 | 0.38 | 379.47 | 40928.23 | 45135.13 | 241.3 | 513.75 | 40.73 | 44.98 |
| 32 | 0.68 | 677.33 | 46351.43 | 50101.67 | 275.94 | 920.94 | 46.12 | 49.96 |
| 64 | 1.2 | 1195.02 | 53106.61 | 55870.75 | 351.84 | 1788.12 | 52.81 | 55.65 |
| 128 | 1.94 | 1938.2 | 65519.7 | 71692.18 | 482.37 | 3318.27 | 65.1 | 71.44 |